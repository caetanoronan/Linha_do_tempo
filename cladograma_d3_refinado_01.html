<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cladograma Interativo: Evolu√ß√£o de Cynodontia</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
        :root {
            --bg-color: #FFEE8C;
            --text-color: #1a1a1a;
            --border-color: #e0d47a;
            --card-bg: #fffef0;
            --accent-color: #1971c2;
            --hover-color: rgba(255, 235, 59, 0.7);
            --era-bg: #fff9d6;
            --shadow: rgba(0,0,0,0.12);
            --branch-color: #2c3e50;
        }

        .dark-mode {
            --bg-color: #1a1a1a;
            --text-color: #e9ecef;
            --border-color: #495057;
            --card-bg: #2d3748;
            --accent-color: #4dabf7;
            --hover-color: rgba(255, 193, 7, 0.3);
            --era-bg: #343a40;
            --shadow: rgba(0,0,0,0.3);
            --branch-color: #adb5bd;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #FFEE8C 0%, #FFE066 100%);
            color: var(--text-color);
            transition: all 0.3s ease;
            min-height: 100vh;
        }
        
        .dark-mode body {
            background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%);
        }

        .wrapper {
            display: flex;
            gap: 30px;
            width: 100%;
            max-width: 1600px;
            margin: 0 auto;
        }

        .cladogram-container {
            position: relative;
            flex: 1;
            min-width: 900px;
            height: 800px;
            border: 2px solid var(--border-color);
            border-radius: 12px;
            overflow: visible;
            background-color: var(--card-bg);
            box-shadow: 0 8px 24px var(--shadow);
        }

        .taxon-name {
            font-size: 16px;
            font-style: italic;
            font-weight: 500;
            cursor: pointer;
            padding: 6px 12px;
            border-radius: 6px;
            transition: all 0.3s ease;
            background: rgba(255, 255, 255, 0.6);
            border: 1px solid var(--border-color);
        }

        .taxon-name:hover {
            background-color: var(--hover-color);
            transform: translateY(-2px);
            box-shadow: 0 4px 8px var(--shadow);
        }

        .taxon-name.active {
            background-color: var(--accent-color);
            color: white;
            border-color: var(--accent-color);
            font-weight: 600;
        }

        .skull-image {
            width: 120px;
            height: 80px;
            object-fit: cover;
            cursor: pointer;
            transition: all 0.3s ease;
            border-radius: 8px;
            border: 2px solid var(--border-color);
            background: white;
            padding: 4px;
            filter: drop-shadow(0 2px 4px var(--shadow));
        }

        .skull-image:hover {
            transform: scale(1.15);
            filter: drop-shadow(0 6px 12px var(--shadow));
            border-color: var(--accent-color);
            z-index: 10;
        }

        .age-label {
            font-size: 13px;
            font-weight: 600;
            color: var(--text-color);
            padding: 4px 10px;
            border-radius: 12px;
            background: rgba(255,255,255,0.95);
            border: 1px solid var(--accent-color);
            box-shadow: 0 2px 4px var(--shadow);
        }

        .dark-mode .age-label {
            background: rgba(45, 55, 72, 0.95);
            color: #e9ecef;
        }

        .branch {
            stroke: var(--branch-color);
            stroke-width: 3;
            fill: none;
            stroke-linecap: round;
        }

        .group-label {
            font-weight: 700;
            font-size: 14px;
            color: var(--accent-color);
            opacity: 0.9;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .details-container {
            width: 450px;
            padding: 30px;
            border: 2px solid var(--border-color);
            border-radius: 12px;
            background-color: var(--card-bg);
            position: sticky;
            top: 20px;
            height: fit-content;
            box-shadow: 0 8px 24px var(--shadow);
        }

        .details-container h2 { 
            margin-top: 0; 
            margin-bottom: 20px;
            color: var(--accent-color); 
            font-size: 28px;
            font-weight: 700;
            border-bottom: 3px solid var(--accent-color);
            padding-bottom: 10px;
        }

        .details-container img { 
            width: 100%;
            height: auto;
            max-height: 280px;
            object-fit: contain;
            border-radius: 8px; 
            margin-bottom: 20px; 
            border: 2px solid var(--border-color);
            background: white;
            padding: 10px;
            box-shadow: 0 4px 12px var(--shadow);
        }

        .details-container p {
            line-height: 1.7;
            font-size: 15px;
            color: var(--text-color);
        }

        .era { 
            font-size: 15px; 
            color: var(--text-color); 
            background-color: var(--era-bg); 
            padding: 15px 18px; 
            border-radius: 8px; 
            margin-top: 20px; 
            border-left: 5px solid var(--accent-color);
            box-shadow: 0 2px 8px var(--shadow);
        }
        
        .era strong {
            color: var(--accent-color);
        }

        .controls {
            position: absolute;
            top: 15px;
            right: 15px;
            background: var(--card-bg);
            padding: 10px;
            border-radius: 10px;
            box-shadow: 0 4px 12px var(--shadow);
            border: 2px solid var(--border-color);
            display: flex;
            gap: 8px;
            z-index: 100;
        }

        .theme-toggle {
            background: var(--accent-color);
            color: white;
            border: none;
            padding: 10px 16px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 15px;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 2px 6px var(--shadow);
        }

        .theme-toggle:hover {
            opacity: 0.9;
            transform: translateY(-2px);
            box-shadow: 0 4px 10px var(--shadow);
        }
        
        h1 {
            text-align: center;
            color: var(--text-color);
            font-size: 32px;
            margin-bottom: 30px;
            text-shadow: 0 2px 4px var(--shadow);
        }

        .time-axis text {
            fill: var(--text-color);
        }

        .time-axis path,
        .time-axis line {
            stroke: var(--text-color);
        }
    </style>
</head>
<body>

<h1>ü¶¥ Cladograma Interativo: Evolu√ß√£o de Cynodontia ‚Üí Mammalia</h1>

<div class="wrapper">
    <div class="cladogram-container">
        <div class="controls">
            <button class="theme-toggle" onclick="toggleDarkMode()">
                üåô Modo Escuro
            </button>
        </div>
        <svg id="cladogram"></svg>
    </div>

    <div class="details-container">
        <h2 id="details-title">Bem-vindo!</h2>
        <img id="details-image" src="images/cladogram-overview.png" alt="Vis√£o geral">
        <p id="details-text"><strong>üëÜ Clique em um t√°xon para ver os detalhes.</strong><br><br>Este cladograma mostra a transi√ß√£o gradual de cinodontes basais para formas mais derivadas, culminando nos mam√≠feros modernos. As principais transforma√ß√µes ocorreram na estrutura da mand√≠bula, denti√ß√£o heterodonte e evolu√ß√£o do ouvido m√©dio.</p>
        <div id="details-era" class="era" style="display:none;"></div>
    </div>
</div>

<script>
// Dados do cladograma
const cladogramData = {
    procynosuchus: { 
        title: 'Procynosuchus', 
        text: 'Um dos primeiros e mais basais cinodontes. Possu√≠a um palato secund√°rio parcial e uma postura semi-ereta, mostrando adapta√ß√µes para um estilo de vida semi-aqu√°tico.', 
        image: 'images/procynosuchus.png', 
        era: '<strong>Per√≠odo:</strong> Permiano Superior (~259‚Äì252 Ma)',
        y: 100,
        age: 256
    },
    thrinaxodon: { 
        title: 'Thrinaxodon', 
        text: 'Um pequeno cinodonte do Tri√°ssico Inferior, conhecido por f√≥sseis excepcionalmente preservados. Apresentava uma clara divis√£o dos dentes em incisivos, caninos e p√≥s-caninos e evid√™ncias de um diafragma, sugerindo um metabolismo mais elevado.', 
        image: 'images/thrinaxodon.png', 
        era: '<strong>Per√≠odo:</strong> Tri√°ssico Inferior (~252‚Äì247 Ma)',
        y: 250,
        age: 250
    },
    cynognathus: { 
        title: 'Cynognathus', 
        text: 'Um predador do tamanho de um lobo do Tri√°ssico M√©dio. Seu cr√¢nio era robusto e o osso dent√°rio constitu√≠a a maior parte da mand√≠bula, uma caracter√≠stica chave na transi√ß√£o para os mam√≠feros.', 
        image: 'images/cynognathus.png', 
        era: '<strong>Per√≠odo:</strong> Tri√°ssico M√©dio (~247‚Äì237 Ma)',
        y: 350,
        age: 242
    },
    morganucodon: { 
        title: 'Morganucodon', 
        text: 'Um dos mais conhecidos Mammaliaformes. Era um pequeno animal noturno, provavelmente inset√≠voro. √â crucial para o estudo da evolu√ß√£o do ouvido m√©dio dos mam√≠feros e da articula√ß√£o da mand√≠bula dent√°rio-esquamosal.', 
        image: 'images/morganucodon.png', 
        era: '<strong>Per√≠odo:</strong> Tri√°ssico Superior ao Jur√°ssico Inferior (~205 Ma)',
        y: 450,
        age: 205
    },
    ornithorhynchus: { 
        title: 'Ornithorhynchus (Ornitorrinco)', 
        text: 'Um mam√≠fero moderno do grupo dos monotremados. Representa uma linhagem que divergiu cedo na evolu√ß√£o dos mam√≠feros. Apesar de moderno, ret√©m caracter√≠sticas ancestrais como a oviparidade (p√¥r ovos).', 
        image: 'images/ornithorhynchus.png', 
        era: '<strong>Per√≠odo:</strong> Quatern√°rio (Atual; 0 Ma)',
        y: 600,
        age: 0
    }
};

// Configura√ß√£o do D3
const svg = d3.select('#cladogram')
    .attr('width', '100%')
    .attr('height', '100%');

const g = svg.append('g');

// Fun√ß√£o para alternar modo escuro
function toggleDarkMode() {
    const body = document.body;
    const isDarkMode = body.classList.contains('dark-mode');
    const themeButton = document.querySelector('.theme-toggle');
    
    if (isDarkMode) {
        body.classList.remove('dark-mode');
        themeButton.textContent = 'üåô Modo Escuro';
        themeButton.title = 'Ativar modo escuro';
    } else {
        body.classList.add('dark-mode');
        themeButton.textContent = '‚òÄÔ∏è Modo Claro';
        themeButton.title = 'Ativar modo claro';
    }
    
    // Salvar prefer√™ncia do usu√°rio
    localStorage.setItem('darkMode', !isDarkMode);
}

// Verificar prefer√™ncia salva do usu√°rio
function checkSavedTheme() {
    const savedDarkMode = localStorage.getItem('darkMode') === 'true';
    const themeButton = document.querySelector('.theme-toggle');
    
    if (savedDarkMode) {
        document.body.classList.add('dark-mode');
        themeButton.textContent = '‚òÄÔ∏è Modo Claro';
        themeButton.title = 'Ativar modo claro';
    }
}

// Desenhar o cladograma
function drawCladogram() {
    // Limpar o SVG
    g.selectAll('*').remove();

    // Grupos taxon√¥micos
    const groups = [
        { name: 'Cynodontia', y: 140, height: 280 },
        { name: 'Eucynodontia', y: 300, height: 350 },
        { name: 'Mammaliaformes', y: 500, height: 250 }
    ];

    // Desenhar grupos
    groups.forEach(group => {
        g.append('text')
            .attr('class', 'group-label')
            .attr('x', 35)
            .attr('y', group.y)
            .attr('transform', `rotate(-90, 35, ${group.y})`)
            .text(group.name);

        // Colchetes dos grupos
        g.append('path')
            .attr('class', 'branch')
            .attr('d', `M50,${group.y - group.height/2} L70,${group.y - group.height/2} L70,${group.y + group.height/2} L50,${group.y + group.height/2}`)
            .style('fill', 'none')
            .style('stroke-width', '2');
    });

    // Desenhar linhas do cladograma
    Object.entries(cladogramData).forEach(([key, data], index) => {
        const startX = 80 + (index * 55);
        
        // Linha horizontal para o t√°xon
        g.append('line')
            .attr('class', 'branch')
            .attr('x1', startX)
            .attr('y1', data.y)
            .attr('x2', 320)
            .attr('y2', data.y);

        // Linha vertical conectando ao pr√≥ximo t√°xon (exceto para o √∫ltimo)
        if (index < Object.entries(cladogramData).length - 1) {
            g.append('line')
                .attr('class', 'branch')
                .attr('x1', startX)
                .attr('y1', data.y)
                .attr('x2', startX)
                .attr('y2', Object.values(cladogramData)[index + 1].y);
        }

        // Adicionar r√≥tulo de idade na linha
        g.append('foreignObject')
            .attr('x', startX - 35)
            .attr('y', data.y - 40)
            .attr('width', 70)
            .attr('height', 30)
            .append('xhtml:div')
            .attr('class', 'age-label')
            .style('text-align', 'center')
            .text(`${data.age} Ma`);

        // Adicionar nome do t√°xon
        const taxonGroup = g.append('foreignObject')
            .attr('x', 320)
            .attr('y', data.y - 15)
            .attr('width', 200)
            .attr('height', 40);

        taxonGroup.append('xhtml:div')
            .attr('class', 'taxon-name')
            .text(data.title)
            .style('cursor', 'pointer')
            .on('click', () => showDetails(key));

        // Adicionar imagem do cr√¢nio
        const imageGroup = g.append('foreignObject')
            .attr('x', 540)
            .attr('y', data.y - 40)
            .attr('width', 130)
            .attr('height', 90);

        imageGroup.append('xhtml:img')
            .attr('class', 'skull-image')
            .attr('src', data.image)
            .style('cursor', 'pointer')
            .on('click', () => showDetails(key));
    });

    // Adicionar escala de tempo
    const timeScale = d3.scaleLinear()
        .domain([300, 0])
        .range([60, 750]);

    const timeAxis = d3.axisLeft(timeScale)
        .ticks(8)
        .tickFormat(d => `${d} Ma`);

    g.append('g')
        .attr('class', 'time-axis')
        .attr('transform', 'translate(50,0)')
        .call(timeAxis);
}

// Fun√ß√£o para mostrar detalhes
function showDetails(taxonId) {
    const data = cladogramData[taxonId];
    
    // Remover classe active de todos os t√°xons
    d3.selectAll('.taxon-name').classed('active', false);
    
    // Adicionar classe active ao t√°xon selecionado
    d3.selectAll('.taxon-name').each(function() {
        if (d3.select(this).text() === data.title) {
            d3.select(this).classed('active', true);
        }
    });

    // Atualizar detalhes
    document.getElementById('details-title').textContent = data.title;
    document.getElementById('details-image').src = data.image;
    document.getElementById('details-text').textContent = data.text;
    document.getElementById('details-era').innerHTML = data.era;
    document.getElementById('details-era').style.display = 'block';
}

// Inicializar o cladograma e verificar tema
drawCladogram();
checkSavedTheme();
</script>

</body>
</html>