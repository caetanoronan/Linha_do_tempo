<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cladograma Interativo: Evolu√ß√£o de Cynodontia</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
        :root {
            --bg-color: #ffffff;
            --text-color: #212529;
            --border-color: #dee2e6;
            --card-bg: #f8f9fa;
            --accent-color: #0d6efd;
            --hover-color: rgba(255, 235, 59, 0.5);
            --era-bg: #e9ecef;
            --shadow: rgba(0,0,0,0.1);
        }

        .dark-mode {
            --bg-color: #1a1a1a;
            --text-color: #e9ecef;
            --border-color: #495057;
            --card-bg: #2d3748;
            --accent-color: #4dabf7;
            --hover-color: rgba(255, 193, 7, 0.3);
            --era-bg: #343a40;
            --shadow: rgba(0,0,0,0.3);
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: var(--bg-color);
            color: var(--text-color);
            transition: all 0.3s ease;
        }

        .wrapper {
            display: flex;
            gap: 40px;
            width: 100%;
            max-width: 1500px;
            margin: 0 auto;
        }

        .cladogram-container {
            position: relative;
            width: 1000px;
            height: 750px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            overflow: hidden;
            background-color: var(--bg-color);
        }

        .taxon-name {
            font-size: 14px;
            font-style: italic;
            cursor: pointer;
            padding: 4px 8px;
            border-radius: 4px;
            transition: all 0.3s ease;
        }

        .taxon-name:hover {
            background-color: var(--hover-color);
        }

        .taxon-name.active {
            background-color: var(--accent-color);
            color: white;
        }

        .skull-image {
            width: 150px;
            height: auto;
            cursor: pointer;
            transition: all 0.3s ease;
            filter: drop-shadow(0 2px 3px var(--shadow));
        }

        .skull-image:hover {
            transform: scale(1.05);
            filter: drop-shadow(0 4px 6px var(--shadow));
        }

        .age-label {
            font-size: 12px;
            color: var(--text-color);
            padding: 2px 6px;
            border-radius: 4px;
            background: rgba(255,255,255,0.9);
            border: 1px solid var(--border-color);
        }

        .dark-mode .age-label {
            background: rgba(45, 55, 72, 0.9);
            color: #e9ecef;
        }

        .branch {
            stroke: var(--text-color);
            stroke-width: 2;
            fill: none;
        }

        .group-label {
            font-weight: bold;
            font-size: 16px;
            color: var(--text-color);
            opacity: 0.8;
        }

        .details-container {
            width: 450px;
            padding: 25px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            background-color: var(--card-bg);
            position: sticky;
            top: 20px;
        }

        .details-container h2 { 
            margin-top: 0; 
            color: var(--text-color); 
            font-size: 24px; 
        }

        .details-container img { 
            max-width: 100%; 
            border-radius: 4px; 
            margin-bottom: 15px; 
            border: 1px solid var(--border-color); 
        }

        .era { 
            font-size: 1em; 
            color: var(--text-color); 
            background-color: var(--era-bg); 
            padding: 12px; 
            border-radius: 4px; 
            margin-top: 15px; 
            border-left: 5px solid var(--accent-color); 
        }

        .controls {
            position: absolute;
            top: 10px;
            right: 10px;
            background: var(--card-bg);
            padding: 8px;
            border-radius: 8px;
            box-shadow: 0 2px 8px var(--shadow);
            border: 1px solid var(--border-color);
            display: flex;
            gap: 5px;
        }

        .theme-toggle {
            background: var(--accent-color);
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .theme-toggle:hover {
            opacity: 0.9;
            transform: translateY(-1px);
        }

        .time-axis text {
            fill: var(--text-color);
        }

        .time-axis path,
        .time-axis line {
            stroke: var(--text-color);
        }
    </style>
</head>
<body>

<div class="wrapper">
    <div class="cladogram-container">
        <div class="controls">
            <button class="theme-toggle" onclick="toggleDarkMode()">
                üåô Modo Escuro
            </button>
        </div>
        <svg id="cladogram"></svg>
    </div>

    <div class="details-container">
        <h2 id="details-title">Cladograma de Cynodontia</h2>
        <img id="details-image" src="images/cladogram-overview.png" alt="Vis√£o geral">
        <p id="details-text">Clique em um t√°xon para ver os detalhes. Este cladograma mostra a transi√ß√£o gradual de cinodontes basais para formas mais derivadas, culminando nos mam√≠feros. As principais mudan√ßas ocorreram na mand√≠bula, denti√ß√£o e ouvido m√©dio.</p>
        <div id="details-era" class="era" style="display:none;"></div>
    </div>
</div>

<script>
// Dados do cladograma
const cladogramData = {
    procynosuchus: { 
        title: 'Procynosuchus', 
        text: 'Um dos primeiros e mais basais cinodontes. Possu√≠a um palato secund√°rio parcial e uma postura semi-ereta, mostrando adapta√ß√µes para um estilo de vida semi-aqu√°tico.', 
        image: 'images/procynosuchus.png', 
        era: '<strong>Per√≠odo:</strong> Permiano Superior (~259‚Äì252 Ma)',
        y: 100,
        age: 256
    },
    thrinaxodon: { 
        title: 'Thrinaxodon', 
        text: 'Um pequeno cinodonte do Tri√°ssico Inferior, conhecido por f√≥sseis excepcionalmente preservados. Apresentava uma clara divis√£o dos dentes em incisivos, caninos e p√≥s-caninos e evid√™ncias de um diafragma, sugerindo um metabolismo mais elevado.', 
        image: 'images/thrinaxodon.png', 
        era: '<strong>Per√≠odo:</strong> Tri√°ssico Inferior (~252‚Äì247 Ma)',
        y: 250,
        age: 250
    },
    cynognathus: { 
        title: 'Cynognathus', 
        text: 'Um predador do tamanho de um lobo do Tri√°ssico M√©dio. Seu cr√¢nio era robusto e o osso dent√°rio constitu√≠a a maior parte da mand√≠bula, uma caracter√≠stica chave na transi√ß√£o para os mam√≠feros.', 
        image: 'images/cynognathus.png', 
        era: '<strong>Per√≠odo:</strong> Tri√°ssico M√©dio (~247‚Äì237 Ma)',
        y: 350,
        age: 242
    },
    morganucodon: { 
        title: 'Morganucodon', 
        text: 'Um dos mais conhecidos Mammaliaformes. Era um pequeno animal noturno, provavelmente inset√≠voro. √â crucial para o estudo da evolu√ß√£o do ouvido m√©dio dos mam√≠feros e da articula√ß√£o da mand√≠bula dent√°rio-esquamosal.', 
        image: 'images/morganucodon.png', 
        era: '<strong>Per√≠odo:</strong> Tri√°ssico Superior ao Jur√°ssico Inferior (~205 Ma)',
        y: 450,
        age: 205
    },
    ornithorhynchus: { 
        title: 'Ornithorhynchus (Ornitorrinco)', 
        text: 'Um mam√≠fero moderno do grupo dos monotremados. Representa uma linhagem que divergiu cedo na evolu√ß√£o dos mam√≠feros. Apesar de moderno, ret√©m caracter√≠sticas ancestrais como a oviparidade (p√¥r ovos).', 
        image: 'images/ornithorhynchus.png', 
        era: '<strong>Per√≠odo:</strong> Quatern√°rio (Atual; 0 Ma)',
        y: 600,
        age: 0
    }
};

// Configura√ß√£o do D3
const svg = d3.select('#cladogram')
    .attr('width', '100%')
    .attr('height', '100%');

const g = svg.append('g');

// Fun√ß√£o para alternar modo escuro
function toggleDarkMode() {
    const body = document.body;
    const isDarkMode = body.classList.contains('dark-mode');
    const themeButton = document.querySelector('.theme-toggle');
    
    if (isDarkMode) {
        body.classList.remove('dark-mode');
        themeButton.textContent = 'üåô Modo Escuro';
        themeButton.title = 'Ativar modo escuro';
    } else {
        body.classList.add('dark-mode');
        themeButton.textContent = '‚òÄÔ∏è Modo Claro';
        themeButton.title = 'Ativar modo claro';
    }
    
    // Salvar prefer√™ncia do usu√°rio
    localStorage.setItem('darkMode', !isDarkMode);
}

// Verificar prefer√™ncia salva do usu√°rio
function checkSavedTheme() {
    const savedDarkMode = localStorage.getItem('darkMode') === 'true';
    const themeButton = document.querySelector('.theme-toggle');
    
    if (savedDarkMode) {
        document.body.classList.add('dark-mode');
        themeButton.textContent = '‚òÄÔ∏è Modo Claro';
        themeButton.title = 'Ativar modo claro';
    }
}

// Desenhar o cladograma
function drawCladogram() {
    // Limpar o SVG
    g.selectAll('*').remove();

    // Grupos taxon√¥micos
    const groups = [
        { name: 'Cynodontia', y: 120, height: 280 },
        { name: 'Eucynodontia', y: 270, height: 350 },
        { name: 'Mammaliaformes', y: 460, height: 250 }
    ];

    // Desenhar grupos
    groups.forEach(group => {
        g.append('text')
            .attr('class', 'group-label')
            .attr('x', 30)
            .attr('y', group.y)
            .attr('transform', `rotate(-90, 30, ${group.y})`)
            .text(group.name);

        // Colchetes dos grupos
        g.append('path')
            .attr('class', 'branch')
            .attr('d', `M40,${group.y - group.height/2} L55,${group.y - group.height/2} L55,${group.y + group.height/2} L40,${group.y + group.height/2}`)
            .style('fill', 'none');
    });

    // Desenhar linhas do cladograma
    Object.entries(cladogramData).forEach(([key, data], index) => {
        const startX = 60 + (index * 50);
        
        // Linha horizontal para o t√°xon
        g.append('line')
            .attr('class', 'branch')
            .attr('x1', startX)
            .attr('y1', data.y)
            .attr('x2', 280)
            .attr('y2', data.y);

        // Linha vertical conectando ao pr√≥ximo t√°xon (exceto para o √∫ltimo)
        if (index < Object.entries(cladogramData).length - 1) {
            g.append('line')
                .attr('class', 'branch')
                .attr('x1', startX)
                .attr('y1', data.y)
                .attr('x2', startX)
                .attr('y2', Object.values(cladogramData)[index + 1].y);
        }

        // Adicionar nome do t√°xon
        const taxonGroup = g.append('g')
            .attr('class', 'taxon-group')
            .attr('transform', `translate(280,${data.y - 10})`);

        taxonGroup.append('text')
            .attr('class', 'taxon-name')
            .text(data.title)
            .style('pointer-events', 'all')
            .on('click', () => showDetails(key));

        // Adicionar imagem do cr√¢nio
        const imageGroup = g.append('g')
            .attr('transform', `translate(450,${data.y - 30})`);

        imageGroup.append('image')
            .attr('class', 'skull-image')
            .attr('href', data.image)
            .attr('width', 150)
            .attr('height', 100)
            .style('cursor', 'pointer')
            .style('pointer-events', 'all')
            .on('click', () => showDetails(key));

        // Adicionar r√≥tulo de idade
        g.append('text')
            .attr('class', 'age-label')
            .attr('x', 420)
            .attr('y', data.y + 5)
            .text(`${data.age} Ma`);
    });

    // Adicionar escala de tempo
    const timeScale = d3.scaleLinear()
        .domain([300, 0])
        .range([40, 720]);

    const timeAxis = d3.axisLeft(timeScale)
        .ticks(7)
        .tickFormat(d => `${d} Ma`);

    g.append('g')
        .attr('class', 'time-axis')
        .attr('transform', 'translate(40,0)')
        .call(timeAxis);
}

// Fun√ß√£o para mostrar detalhes
function showDetails(taxonId) {
    const data = cladogramData[taxonId];
    
    // Remover classe active de todos os t√°xons
    d3.selectAll('.taxon-name').classed('active', false);
    
    // Adicionar classe active ao t√°xon selecionado
    d3.selectAll('.taxon-name').each(function() {
        if (d3.select(this).text() === data.title) {
            d3.select(this).classed('active', true);
        }
    });

    // Atualizar detalhes
    document.getElementById('details-title').textContent = data.title;
    document.getElementById('details-image').src = data.image;
    document.getElementById('details-text').textContent = data.text;
    document.getElementById('details-era').innerHTML = data.era;
    document.getElementById('details-era').style.display = 'block';
}

// Inicializar o cladograma e verificar tema
drawCladogram();
checkSavedTheme();
</script>

</body>
</html>